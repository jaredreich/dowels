var dowels=function(){function e(e){"undefined"!=typeof e&&("undefined"!=typeof e.root&&e.root&&(h=e.root),"undefined"!=typeof e.containerId&&e.containerId&&(m=e.containerId),"undefined"!=typeof e.titleBase&&e.titleBase&&(y=e.titleBase),"undefined"!=typeof e.apiBase&&e.apiBase&&(g=e.apiBase),"undefined"!=typeof e.onLoadStart&&e.onLoadStart&&(v=e.onLoadStart),"undefined"!=typeof e.onLoadUpdate&&e.onLoadUpdate&&(w=e.onLoadUpdate),"undefined"!=typeof e.onLoadStop&&e.onLoadStop&&(L=e.onLoadStop))}function t(e,t){var n={},o=[],i="";if(e instanceof RegExp)i=e.toString().slice(0,-1),i+="(?:/(?=$))?$";else{if("string"!=typeof e)throw"invalid path type, must be regex or string";i="^";for(var r=e.substring(1).split("/"),a=0;a<r.length;a++){var d=r[a];":"===d.charAt(0)?(i+="/([^\\/]+?)",n[d.substring(1)]="",o.push(r.indexOf(d))):i+="*"===d?"/(.*)":"/"+d}i+="(?:/(?=$))?$"}u.push({regex:i,handler:t,parameters:n,parameterLocations:o})}function n(){r(a(),!0)}function o(e){r(e,!0)}function i(e){s.path===e?(window.history.back(),document.title=y+s.path):r(e)}function r(e,t){s.path=a(),s.title=document.title;var n=y+e;t="undefined"==typeof t?!1:t,document.getElementById(m).innerHTML="",""===e&&(e="/");for(var o=0;o<u.length;o++){var i=u[o],r=new RegExp(i.regex,"i");if(r.test(e)){for(var d=e.substring(1).split("/"),p=[],l=0;l<i.parameterLocations.length;l++){var f=i.parameterLocations[l];p.push(d.slice(f,f+1).toString())}var c=0;for(var g in i.parameters)i.parameters.hasOwnProperty(g)&&(i.parameters[g]=p[c],c++);if(t===!0)"/"===e?window.history.replaceState(null,null,h):"/"===h?window.history.replaceState(null,null,e):window.history.replaceState(null,null,h+e);else{if(e===a())return;"/"===e?window.history.pushState(null,null,h):"/"===h?window.history.pushState(null,null,e):window.history.pushState(null,null,h+e)}return document.title=n,void i.handler.apply(null,[i.parameters])}}throw'"'+e+'" does not match a route.'}function a(){return"/"!==h?window.location.pathname.replace(h,""):window.location.pathname}function d(e,t,n){n=n||m;var o=document.getElementById(e);templateHTML=null!=o?o.innerHTML:"<div>template does not exist</div>";var i=templateHTML.match(/<# include (.*) #>/g)||[];console.log(i);for(var r=0;r<i.length;r++){var a=i[r].replace("<# ","").replace(" #>","");a=a.split(" ")[1];var d=document.getElementById(a).innerHTML;templateHTML=templateHTML.replace(/<# include (.*) #>/,d)}t="undefined"!=typeof t&&t?t:{};var p=f[templateHTML];if(!p){var l="var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+templateHTML.replace(/[\r\t\n]/g,"").replace(/'(?=[^#]*#>)/g,"	").split("'").join("\\'").split("	").join("'").replace(/<#=(.+?)#>/g,"',$1,'").split("<#").join("');").split("#>").join("p.push('")+"');}return p.join('');";p=new Function("obj",l),f[templateHTML]=p}document.getElementById(n).innerHTML=p(t)}function p(e,t){var n="",o="",i={},r=["Content-type: application/json"];if("undefined"!=typeof e.method&&e.method){e.method=e.method.toString().toUpperCase();var a=["GET","POST","PUT","DELETE"];if(-1===a.indexOf(e.method))throw'dowels.request "method" must be "get", "post", "put", or "delete"';n=e.method}else n="GET";if("undefined"!=typeof e.endpoint&&e.endpoint&&e.endpoint.length>0)o=g+e.endpoint.toString();else{if(!("undefined"!=typeof e.url&&e.url&&e.url.length>0))throw'dowels.request must have either "endpoint" or "url" specified in options';o=e.url.toString()}"undefined"!=typeof e.body&&e.body&&(i=JSON.stringify(e.body)),"undefined"!=typeof e.headers&&e.headers&&(r=e.headers);var d=new XMLHttpRequest;d.open(n,o,!0);for(var p=0;p<r.length;p++){var l=r[p],u=l.split(": ")[0],s=l.split(": ")[1];d.setRequestHeader(u,s)}v(),c=!0,d.onreadystatechange=function(){if(w(25*d.readyState),4==d.readyState){setTimeout(function(){c&&(L(),c=!1)},50);var e=d.responseText;200==d.status?t&&("undefined"!=typeof e&&e.length>0?t(null,JSON.parse(e)):t(null,null)):t(d.responseText,null)}},d.send(i)}function l(e,t,n){p(t,function(t,o){var i={};i.err=t,i[n]=o,d(e,i)})}var u=[],s={path:"",title:""},f={},c=!1,h="/",m="app",y=document.title,g=document.location.protocol+"//"+document.location.hostname+"/api",v=function(){},w=function(){},L=function(){};return window.addEventListener("popstate",function(e){a()===s.path?r(s.path,!0):r(a(),!0)}),{config:e,add:t,initialize:n,nav:r,back:i,redirect:o,render:d,include:include,request:p,renderAfterRequest:l}}();"object"==typeof module&&module.exports&&(module.exports=dowels);